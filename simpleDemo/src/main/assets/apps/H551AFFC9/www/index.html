<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="js/mui.min.js"></script>
	<script src="js/mui.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
	<style>
		#connect{
			width: 185px !important;
		}
	</style>
    <script type="text/javascript" charset="utf-8">
      	mui.init();
		if(window.plus){
			console.log('a')
			plusReady();
		}else{
			console.log('b')
			document.addEventListener("plusready",plusReady,false);
		}
		//扩展API准备完成后要执行的操作
		function plusReady(){
			
		}
		
		
		
		
    </script>
</head>
<body>
	<!-- 顶部 -->
	<div style="width: 100%;height: 60px;background-color: #007AFF;text-align: center;">
		<h3 style="padding-top: 15px;">倒车雷达系统</h3>
	</div>
	<!-- 连接状态 -->
	<div style="text-align: center;margin-top: 40px;">
		连接状态:<span style="color: red;" id="status">未开启</span>
	</div>
	<!-- 内容部分 -->
	<!-- 输入栏 -->
	<div style="margin-top: 30px; text-align: center;">
	IP地址：<input width="250px" id="connect" value="112.74.186.128:50000"/>
	</div>
	<!-- 按钮 -->
	<div style="text-align: center;margin: 20px;">
	<button style="margin-right:20px;" onclick="connectSocket()">连接</button>
	<button onclick="closeSocket()">断开</button>
	</div>
	<!-- 碰撞距离的显示 -->
	<div style="text-align: center; margin-top:40px ;">
		您现在距离碰撞还剩<br><h1 id="miter" style="margin-top:20px ;">未连接</h1>
	</div>
	<!-- 显示是否安全 -->
	<div style="text-align: center; margin-top:40px ;">
		是否安全:<h1 id="carStatus" style="margin-top:20px ;">未连接<h1>
	</div>
	<!-- 底部导航 -->
	<div class="bottoms" style="margin-top: 101px; height: 45px;box-shadow:0 2px 2px 0 rgba(114, 124, 245, .5);text-align: center; font-size: 20px;border-top:1px solid blue ;">
		<div onclick="backCar()" style="z-index:100;width: 50%;height: 100%;border-right: 1px solid darkgrey;vertical-align:middle;float: left;padding-top:10px ;">倒车信息</div>
		<div onclick="otherMesg()" style="z-index:100;height: 100%;vertical-align:middle;text-align: center;padding-top:10px ;">地图导航</div>
	</div>
	<!-- 语音提示（隐藏） -->
	<audio id = "audio">
	  <source src="music/262.mp3" type="audio/ogg" />
	</audio>
	<!-- 语音提示（隐藏） -->
	<audio id = "audio2">
	  <source src="music/792.mp3" type="audio/ogg" />
	</audio>
	<!-- 语音提示（隐藏） -->
	<audio id = "audio3">
	  <source src="music/6175.mp3" type="audio/ogg" />
	</audio>
	
	<script type="text/javascript">
		var audio = document.getElementById('audio');
		var audio2 = document.getElementById('audio2');
		var audio3 = document.getElementById('audio3');
		/* 倒车信息 */
		function backCar(){
			window.location.href='index.html';
		}
		
		/* 其他信息 */
		function otherMesg(){
			window.location.href='mapShow.html';
		}
		/* 关闭socket */
		function closeSocket(){
			console.log()
			window.WebSocket.close();
		}
		
		/* websocket连接 */
		function connectSocket(){
			console.log(document.getElementById('status').style.color)
			console.log(document.getElementById('connect').value);
			var url = document.getElementById('connect').value;
			if ("WebSocket" in window)
			{
			   console.log("您的浏览器支持 WebSocket!");
			   // 打开一个 web socket
			   var ws = new WebSocket("ws://"+url);
			   //成功连接
			   ws.onopen = function()
			   {
			      // 成功连接后修改样式
				 document.getElementById('status').innerText = '已连接';
				 document.getElementById('carStatus').innerHTML = '已连接';
				 document.getElementById('miter').innerText = '已连接';
				 document.getElementById('status').style.color = 'green';
				 document.getElementById('connect').disabled = 'disabled';
				 document.getElementById('miter').style.color = 'green';
				 document.getElementById('carStatus').style.color = 'green';
			     ws.send("发送数据,123");
			     console.log("数据发送中...");
			   };
			  
			  //接受到消息
			   ws.onmessage = function (evt) 
			   { 
				   console.log(evt.data)
				   /* 将接收到的数据加上单位显示到页面*/
				   document.getElementById('miter').innerText = evt.data+'厘米';
				   /* 判断是否是安全距离*/
				   if(evt.data>30){
					   /* 清除音效*/
					   audio.pause();
					   audio.currentTime = 0;
					   audio2.pause();
					   audio2.currentTime = 0;
					   audio3.pause();
					   audio3.currentTime = 0;
					   /* 显示安全*/
					   document.getElementById('carStatus').innerText = '安全';
					   document.getElementById('carStatus').style.color = 'green';
				   }else{
					   /* 距离小于3的操作;播放语音提示,显示危险字样*/
					   if(evt.data<30){
						   console.log('30')
						   audio2.pause();
						   audio2.currentTime = 0;
						   audio3.pause();
						   audio3.currentTime = 0;
						   audio.play();
					   }else if(evt.data > 20 ){
						   console.log('20')
						   audio.pause();
						   audio.currentTime = 0;
						   audio3.pause();
						   audio3.currentTime = 0;
						   audio2.play();
					   }else if(evt.data > 10){
						   console.log('10')
						   audio.pause();
						   audio.currentTime = 0;
						   audio2.pause();
						   audio2.currentTime = 0;   
						   audio3.play();
					   }
					   document.getElementById('carStatus').innerHTML = '危险,请注意！';
					   document.getElementById('carStatus').style.color = 'red';
				   }
			   };
			   
			   ws.onclose = function()
			   { 
			      // 关闭 websocket并恢复样式
			      document.getElementById('status').innerText = '连接断开';
			      document.getElementById('status').style.color = 'red';
				  document.getElementById('miter').innerText = '连接断开';
				  document.getElementById('miter').style.color = 'red';
				  document.getElementById('carStatus').innerText = '连接断开';
				  document.getElementById('carStatus').style.color = 'red';
			   };
			}
			else
			{
			   // 浏览器不支持 WebSocket
			   console.log("您的浏览器不支持 WebSocket!");
			}
		}
		
		
	</script>
	
</body>
</html>